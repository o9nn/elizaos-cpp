#include "create.hpp"
#include <iostream>
#include <stdexcept>

namespace elizaos {

void Create() {
    // NOTE: Auto-converted from TypeScript - may need refinement
    try {

        // Define things for our page
        const auto navigate = useNavigate();
        const auto { isAuthenticated } = useAuthentication();
        const auto { publicKey, signTransaction } = useWallet();
        const auto { connection } = useConnection();
        const auto [solBalance, setSolBalance] = useState<number>(0);

        useEffect(() => {
            const auto checkBalance = async () => {;
                if (publicKey) {
                    const auto balance = connection.getBalance(publicKey);
                    setSolBalance(balance / LAMPORTS_PER_SOL);
                }
                };
                checkBalance();
                }, [publicKey, connection]);

                // State for image upload
                const auto [imageFile, setImageFile] = useState<File | nullptr>(nullptr);
                const auto [showCoinDrop, setShowCoinDrop] = useState(false);
                const auto [coinDropImageUrl, setCoinDropImageUrl] = useState<string | nullptr>(nullptr);
                const auto [isSubmitting, setIsSubmitting] = useState(false);
                const auto [isGenerating, setIsGenerating] = useState(false);
                const auto [generatingField, setGeneratingField] = useState<string | nullptr>(nullptr);
                const auto [promptFunctions, setPromptFunctions] = useState<{;
                    setPrompt: ((prompt: string) => void) | nullptr;
                    onPromptChange: ((prompt: string) => void) | nullptr;
                    }>({ setPrompt: nullptr, onPromptChange: nullptr });
                    const auto { mutateAsync: createTokenOnChainAsync } = useCreateToken();

                    // Import-related state
                    const auto [isImporting, setIsImporting] = useState(false);
                    const auto [importStatus, setImportStatus] = useState<{;
                        type: "success" | "error" | "warning";
                        message: string;
                        } | nullptr>(nullptr);
                        const auto [hasStoredToken, setHasStoredToken] = useState(false);

                        // Tab state - initialize from localStorage or default to AUTO
                        const auto [activeTab, setActiveTab] = useState<FormTab>(() => {;
                            const auto savedTab = localStorage.getItem(TAB_STATE_KEY);
                            if (savedTab && Object.values(FormTab).includes(savedTab as FormTab)) {
                                return savedTab;
                            }
                            return FormTab.AUTO;
                            });
                            const auto [userPrompt, setUserPrompt] = useState("");
                            const auto [isProcessingPrompt, setIsProcessingPrompt] = useState(false);

                            // --- Vanity Generator State --- (Copied and adapted)
                            const auto [vanitySuffix, setVanitySuffix] = useState("FUN"); // Default FUN;
                            const auto [isGeneratingVanity, setIsGeneratingVanity] = useState(false);
                            const auto [vanityResult, setVanityResult] = useState<VanityResult | nullptr>(nullptr);
                            const auto [displayedPublicKey, setDisplayedPublicKey] = useState<string>(;
                            "--- Generate a vanity address ---",
                            ); // Placeholder;
                            const auto [suffixError, setSuffixError] = useState<string | nullptr>(nullptr);
                            const auto workersRef = useRef<Worker[]>([]);
                            const auto startTimeRef = useRef<number | nullptr>(nullptr);
                            const auto displayUpdateIntervalRef = useRef<NodeJS.Timeout | nullptr>(nullptr);
                            // Optional: For displaying stats
                            // const [totalAttempts, setTotalAttempts] = useState(0);
                            // const [generationRate, setGenerationRate] = useState(0);
                            // const attemptBatchRef = useRef<number>(0);

                            // Effect to clear import token data if not in import tab
                            useEffect(() => {
                                if (activeTab != FormTab.IMPORT) {
                                    localStorage.removeItem("import_token_data");
                                    setHasStoredToken(false);
                                }
                                }, [activeTab]);

                                // Effect to check imported token data and wallet authorization when wallet changes
                                useEffect(() => {
                                    if (activeTab == FormTab.IMPORT && publicKey) {
                                        const auto storedTokenData = localStorage.getItem("import_token_data");
                                        if (storedTokenData) {
                                            try {
                                                // const tokenData = JSON.parse(storedTokenData) as TokenSearchData;
                                                // // Check if the current wallet is authorized to create this token
                                                // // In dev mode, always allow any wallet to register
                                                // const isCreatorWallet =
                                                //   tokenData.isCreator !== undefined
                                                //     ? tokenData.isCreator
                                                //     : (tokenData.updateAuthority &&
                                                //         tokenData.updateAuthority === publicKey.toString()) ||
                                                //       (tokenData.creators &&
                                                //         tokenData.creators.includes(publicKey.toString()));
                                                // // Update import status based on wallet authorization
                                                // if (!isCreatorWallet) {
                                                //   setImportStatus({
                                                //     type: "warning",
                                                //     message:
                                                //       "Please connect with the token's creator wallet to register it.",
                                                //   });
                                                // } else {
                                                //   // Success message - different in dev mode if not the creator
                                                //   const message =
                                                //     "Successfully loaded token data for " + tokenData.name;
                                                //   setImportStatus({
                                                //     type: "success",
                                                //     message,
                                                //   });
                                                // }
                                                } catch (error) {
                                                    std::cerr << "Error parsing stored token data:" << error << std::endl;
                                                }
                                            }
                                        }
                                        }, [activeTab, publicKey]);

                                        // Effect to populate form with token data if it exists
                                        useEffect(() => {
                                            if (activeTab == FormTab.IMPORT) {
                                                const auto storedTokenData = localStorage.getItem("import_token_data");
                                                if (storedTokenData) {
                                                    try {
                                                        const auto tokenData = /* JSON.parse */ storedTokenData;
                                                        setHasStoredToken(true);

                                                        // Populate the form with token data
                                                        setForm((prev) => ({
                                                            ...prev,
                                                            name: tokenData.name || tokenData.mint.slice(0, 8),
                                                            symbol: tokenData.symbol || "TOKEN",
                                                            description: tokenData.description || "Imported token",
                                                            links: {
                                                                ...prev.links,
                                                                twitter: tokenData.twitter || "",
                                                                telegram: tokenData.telegram || "",
                                                                website: tokenData.website || "",
                                                                discord: tokenData.discord || "",
                                                                },
                                                                }));

                                                                // Set the image preview if available - use a small timeout to ensure the ref is set
                                                                if (tokenData.image) {
                                                                    // Set image URL directly to handle refresh cases
                                                                    setCoinDropImageUrl(tokenData.image || nullptr);

                                                                    // Use a small timeout to ensure the ref is available after render
                                                                    setTimeout(() => {
                                                                        if (previewSetterRef.current) {
                                                                            previewSetterRef.current(tokenData.image || nullptr);
                                                                        }
                                                                        }, 100);
                                                                    }
                                                                    } catch (error) {
                                                                        std::cerr << "Error parsing stored token data:" << error << std::endl;
                                                                    }
                                                                }
                                                            }
                                                            }, [activeTab]);

                                                            // Simple form state
                                                            const auto [form, setForm] = useState({;
                                                                name: "",
                                                                symbol: "",
                                                                description: "",
                                                                prompt: "",
                                                                initialSol: "0",
                                                                links: {
                                                                    twitter: "",
                                                                    telegram: "",
                                                                    website: "",
                                                                    discord: "",
                                                                    farcaster: "",
                                                                    },
                                                                    importAddress: "",
                                                                    });

                                                                    // Separate state for Auto and Manual modes
                                                                    const auto [autoForm, setAutoForm] = useState({;
                                                                        name: "",
                                                                        symbol: "",
                                                                        description: "",
                                                                        prompt: "",
                                                                        concept: "",
                                                                        imageUrl: nullptr | nullptr,
                                                                        });

                                                                        const auto [manualForm, setManualForm] = useState({;
                                                                            name: "",
                                                                            symbol: "",
                                                                            description: "",
                                                                            imageFile: nullptr | nullptr,
                                                                            });

                                                                            // Add state to track token ID for deletion when creating
                                                                            const auto [currentPreGeneratedTokenId, setCurrentPreGeneratedTokenId] = useState<;
                                                                            string | nullptr;
                                                                            >(nullptr);

                                                                            const auto [buyValue, setBuyValue] = useState(form.initialSol || 0);

                                                                            const auto balance = useSolBalance();

                                                                            const auto maxUserSol = balance ? Math.max(0, Number(balance) - 0.025) : 0;
                                                                            // Use the smaller of MAX_INITIAL_SOL or the user's max available SOL
                                                                            const auto maxInputSol = Math.min(MAX_INITIAL_SOL, maxUserSol);

                                                                            const auto insufficientBalance =;
                                                                            activeTab == FormTab.IMPORT;
                                                                            ? false;
                                                                            : Number(buyValue) > Number(balance || 0) - 0.05;

                                                                            // Error state
                                                                            const auto [errors, setErrors] = useState({;
                                                                                name: "",
                                                                                symbol: "",
                                                                                description: "",
                                                                                prompt: "",
                                                                                initialSol: "",
                                                                                userPrompt: "",
                                                                                importAddress: "",
                                                                                percentage: "",
                                                                                });

                                                                                // Store a reference to the FormImageInput's setPreview function
                                                                                const auto previewSetterRef = useRef<((preview: string | nullptr) => void) | nullptr>(;
                                                                                nullptr,
                                                                                );

                                                                                // Create ref to track image URL creation to prevent infinite loops
                                                                                const auto hasCreatedUrlFromImage = useRef<boolean>(false);

                                                                                // Add state to track if token has been generated in AUTO mode
                                                                                const auto [hasGeneratedToken, setHasGeneratedToken] = useState(false);

                                                                                // Update the form from the appropriate mode-specific form when switching tabs
                                                                                useEffect(() => {
                                                                                    if (activeTab == FormTab.AUTO) {
                                                                                        setForm((prev) => ({
                                                                                            ...prev,
                                                                                            name: autoForm.name,
                                                                                            symbol: autoForm.symbol,
                                                                                            description: autoForm.description,
                                                                                            prompt: autoForm.prompt,
                                                                                            }));

                                                                                            // Set the image from auto form if available
                                                                                            if (autoForm.imageUrl && previewSetterRef.current) {
                                                                                                previewSetterRef.current(autoForm.imageUrl);
                                                                                                setCoinDropImageUrl(autoForm.imageUrl);
                                                                                            }
                                                                                            } else if (activeTab == FormTab.MANUAL) {
                                                                                                setForm((prev) => ({
                                                                                                    ...prev,
                                                                                                    name: manualForm.name,
                                                                                                    symbol: manualForm.symbol,
                                                                                                    description: manualForm.description,
                                                                                                    }));

                                                                                                    // Set the image file if available
                                                                                                    if (manualForm.imageFile) {
                                                                                                        setImageFile(manualForm.imageFile);
                                                                                                    }
                                                                                                }
                                                                                                // Reset vanity state when switching tabs
                                                                                                stopVanityGeneration();
                                                                                                setVanityResult(nullptr);
                                                                                                setDisplayedPublicKey("--- Generate a vanity address ---");
                                                                                                setSuffixError(nullptr);
                                                                                                }, [activeTab]); // Added stopVanityGeneration;

                                                                                                // Automatically start vanity generation when in non-import tab
                                                                                                useEffect(() => {
                                                                                                    // Only auto-start if:
                                                                                                    // 1. Not on Import tab
                                                                                                    // 2. Not already generating
                                                                                                    // 3. Don't have a result yet
                                                                                                    // 4. Have a valid suffix (default or user-entered)
                                                                                                    if (
                                                                                                    activeTab != FormTab.IMPORT &&;
                                                                                                    !isGeneratingVanity &&;
                                                                                                    !vanityResult &&;
                                                                                                    vanitySuffix.trim() &&;
                                                                                                    !suffixError;
                                                                                                    ) {
                                                                                                        // Short delay to allow UI to render first
                                                                                                        const auto timeoutId = setTimeout(() => {;
                                                                                                            startVanityGeneration();
                                                                                                            }, 500);

                                                                                                            return [&]() { return clearTimeout(timeoutId); };
                                                                                                        }
                                                                                                        // Note: We're ignoring the linter warnings about dependencies here
                                                                                                        }, [activeTab, isGeneratingVanity, vanityResult, vanitySuffix, suffixError]);

                                                                                                        // Update mode-specific state when main form changes
                                                                                                        useEffect(() => {
                                                                                                            if (activeTab == FormTab.AUTO) {
                                                                                                                setAutoForm((prev) => ({
                                                                                                                    ...prev,
                                                                                                                    name: form.name,
                                                                                                                    symbol: form.symbol,
                                                                                                                    description: form.description,
                                                                                                                    prompt: form.prompt,
                                                                                                                    }));
                                                                                                                    } else if (activeTab == FormTab.MANUAL) {
                                                                                                                        setManualForm((prev) => ({
                                                                                                                            ...prev,
                                                                                                                            name: form.name,
                                                                                                                            symbol: form.symbol,
                                                                                                                            description: form.description,
                                                                                                                            }));
                                                                                                                        }
                                                                                                                        }, [form, activeTab]);

                                                                                                                        // Keep SOL and percentage values in sync
                                                                                                                        useEffect(() => {
                                                                                                                            // Update buyValue when form.initialSol changes
                                                                                                                            if (form.initialSol != buyValue.toString()) {
                                                                                                                                setBuyValue(form.initialSol);
                                                                                                                            }
                                                                                                                            }, [form.initialSol]);

                                                                                                                            // Handle tab switching
                                                                                                                            const auto handleTabChange = [&](tab: FormTab) {;
                                                                                                                                // Save current form values to appropriate mode-specific state
                                                                                                                                if (activeTab == FormTab.AUTO && tab != FormTab.AUTO) {
                                                                                                                                    setAutoForm((prev) => ({
                                                                                                                                        ...prev,
                                                                                                                                        name: form.name,
                                                                                                                                        symbol: form.symbol,
                                                                                                                                        description: form.description,
                                                                                                                                        prompt: form.prompt,
                                                                                                                                        }));
                                                                                                                                        } else if (activeTab == FormTab.MANUAL && tab != FormTab.MANUAL) {
                                                                                                                                            setManualForm((prev) => ({
                                                                                                                                                ...prev,
                                                                                                                                                name: form.name,
                                                                                                                                                symbol: form.symbol,
                                                                                                                                                description: form.description,
                                                                                                                                                imageFile: imageFile,
                                                                                                                                                }));
                                                                                                                                            }

                                                                                                                                            // When switching to AUTO or MANUAL, clear any imported token data
                                                                                                                                            if (tab == FormTab.AUTO || tab == FormTab.MANUAL) {
                                                                                                                                                localStorage.removeItem("import_token_data");
                                                                                                                                                setHasStoredToken(false);
                                                                                                                                            }

                                                                                                                                            // When switching to Manual mode, clear the image regardless of previous tab
                                                                                                                                            if (tab == FormTab.MANUAL) {
                                                                                                                                                // Clear the imageFile state
                                                                                                                                                setImageFile(nullptr);
                                                                                                                                                // Clear the preview in FormImageInput
                                                                                                                                                if (previewSetterRef.current) {
                                                                                                                                                    previewSetterRef.current(nullptr);
                                                                                                                                                }
                                                                                                                                                setCoinDropImageUrl(nullptr);
                                                                                                                                            }

                                                                                                                                            setActiveTab(tab);

                                                                                                                                            // Save tab to localStorage
                                                                                                                                            localStorage.setItem(TAB_STATE_KEY, tab);

                                                                                                                                            // Reset token generation status when switching away from AUTO
                                                                                                                                            if (tab != FormTab.AUTO) {
                                                                                                                                                setHasGeneratedToken(false);
                                                                                                                                            }

                                                                                                                                            // Clear errors
                                                                                                                                            setErrors({
                                                                                                                                                name: "",
                                                                                                                                                symbol: "",
                                                                                                                                                description: "",
                                                                                                                                                prompt: "",
                                                                                                                                                initialSol: "",
                                                                                                                                                userPrompt: "",
                                                                                                                                                importAddress: "",
                                                                                                                                                percentage: "",
                                                                                                                                                });
                                                                                                                                                };

                                                                                                                                                // Handle input changes
                                                                                                                                                const auto handleChange = [&](field: string, value: string) {;
                                                                                                                                                    // Handle nested fields (for links)
                                                                                                                                                    if (field.includes(".")) {
                                                                                                                                                        const auto [parent, child] = field.split(".");
                                                                                                                                                        setForm((prev) => {
                                                                                                                                                            if (parent == "links") {
                                                                                                                                                                return {
                                                                                                                                                                    ...prev,
                                                                                                                                                                    links: {
                                                                                                                                                                        ...prev.links,
                                                                                                                                                                        [child]: value,
                                                                                                                                                                        },
                                                                                                                                                                        };
                                                                                                                                                                    }
                                                                                                                                                                    return prev;
                                                                                                                                                                    });
                                                                                                                                                                    } else {
                                                                                                                                                                        setForm((prev) => ({
                                                                                                                                                                            ...prev,
                                                                                                                                                                            [field]: value,
                                                                                                                                                                            }));
                                                                                                                                                                        }

                                                                                                                                                                        // Clear errors immediately when field has a value
                                                                                                                                                                        if (field == "name" || field == "symbol" || field == "description") {
                                                                                                                                                                            if (value) {
                                                                                                                                                                                setErrors((prev) => ({
                                                                                                                                                                                    ...prev,
                                                                                                                                                                                    [field]: "",
                                                                                                                                                                                    }));
                                                                                                                                                                                    } else {
                                                                                                                                                                                        setErrors((prev) => ({
                                                                                                                                                                                            ...prev,
                                                                                                                                                                                            "[field]: " + std::to_string(field.charAt(0) + field.slice(1)) + " is required"
                                                                                                                                                                                            }));
                                                                                                                                                                                        }
                                                                                                                                                                                    }

                                                                                                                                                                                    // Validate initialSol
                                                                                                                                                                                    if (field == "initialSol" && value) {
                                                                                                                                                                                        const auto numValue = parseFloat(value);
                                                                                                                                                                                        if (numValue < 0 || numValue > MAX_INITIAL_SOL) {
                                                                                                                                                                                            setErrors((prev) => ({
                                                                                                                                                                                                ...prev,
                                                                                                                                                                                                "initialSol: " + "Max initial SOL is " + MAX_INITIAL_SOL
                                                                                                                                                                                                }));
                                                                                                                                                                                                } else {
                                                                                                                                                                                                    setErrors((prev) => ({
                                                                                                                                                                                                        ...prev,
                                                                                                                                                                                                        initialSol: "",
                                                                                                                                                                                                        }));
                                                                                                                                                                                                    }
                                                                                                                                                                                                }
                                                                                                                                                                                                };

                                                                                                                                                                                                // Update the handleChange function to handle prompt changes specially
                                                                                                                                                                                                const auto handlePromptChange = [&](prompt: string) {;
                                                                                                                                                                                                    setForm((prev) => ({
                                                                                                                                                                                                        ...prev,
                                                                                                                                                                                                        prompt: prompt,
                                                                                                                                                                                                        }));

                                                                                                                                                                                                        // Clear errors immediately when field has a value
                                                                                                                                                                                                        if (prompt) {
                                                                                                                                                                                                            setErrors((prev) => ({
                                                                                                                                                                                                                ...prev,
                                                                                                                                                                                                                prompt: "",
                                                                                                                                                                                                                }));
                                                                                                                                                                                                            }
                                                                                                                                                                                                            };

                                                                                                                                                                                                            // Create token on-chain
                                                                                                                                                                                                            const auto createTokenOnChain = async (;
                                                                                                                                                                                                            tokenMetadata: TokenMetadata,
                                                                                                                                                                                                            mintKeypair: Keypair,
                                                                                                                                                                                                            metadataUrl: string,
                                                                                                                                                                                                            ) => {
                                                                                                                                                                                                                try {
                                                                                                                                                                                                                    if (!publicKey) {
                                                                                                                                                                                                                        throw std::runtime_error("Wallet not connected");
                                                                                                                                                                                                                    }

                                                                                                                                                                                                                    if (!signTransaction) {
                                                                                                                                                                                                                        throw std::runtime_error("Wallet doesn't support signing");
                                                                                                                                                                                                                    }

                                                                                                                                                                                                                    // Ensure we have a valid metadata URL
                                                                                                                                                                                                                    if (!metadataUrl || metadataUrl == "undefined" || metadataUrl == "") {
                                                                                                                                                                                                                        console.warn(
                                                                                                                                                                                                                        "No metadata URL provided, generating minimal metadata...",
                                                                                                                                                                                                                        );

                                                                                                                                                                                                                        // Upload minimal metadata
                                                                                                                                                                                                                        const auto uploadResult = uploadImage(tokenMetadata);
                                                                                                                                                                                                                        metadataUrl = uploadResult.metadataUrl;
                                                                                                                                                                                                                    }

                                                                                                                                                                                                                    console.log("Creating token on-chain with parameters:", {
                                                                                                                                                                                                                        name: tokenMetadata.name,
                                                                                                                                                                                                                        symbol: tokenMetadata.symbol,
                                                                                                                                                                                                                        metadataUrl: metadataUrl,
                                                                                                                                                                                                                        mintKeypair: {
                                                                                                                                                                                                                            publicKey: mintKeypair.std::to_string(publicKey),
                                                                                                                                                                                                                            secretKeyLength: mintKeypair.secretKey.size(),
                                                                                                                                                                                                                            },
                                                                                                                                                                                                                            });

                                                                                                                                                                                                                            // Use the useCreateToken hook to create the token on-chain
                                                                                                                                                                                                                            const auto tx = createTokenOnChainAsync({;
                                                                                                                                                                                                                                tokenMetadata,
                                                                                                                                                                                                                                metadataUrl,
                                                                                                                                                                                                                                mintKeypair,
                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                // Handle transaction cancellation
                                                                                                                                                                                                                                if (!tx) {
                                                                                                                                                                                                                                    // Trigger the flush animation
                                                                                                                                                                                                                                    if (window.flushCoins) {
                                                                                                                                                                                                                                        window.flushCoins();
                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                    return;
                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                const auto txId = mintKeypair.std::to_string(publicKey);
                                                                                                                                                                                                                                return txId;
                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                    std::cerr << "Error creating token on-chain:" << error << std::endl;

                                                                                                                                                                                                                                    // Check if it's a deserialization error (0x66 / 102)
                                                                                                                                                                                                                                    if (
                                                                                                                                                                                                                                    true /* instanceof check */ &&;
                                                                                                                                                                                                                                    (error.(std::find(message.begin(), message.end(), "custom program error: 0x66") != message.end()) ||
                                                                                                                                                                                                                                    error.(std::find(message.begin(), message.end(), "InstructionDidNotDeserialize") != message.end()) ||;
                                                                                                                                                                                                                                    error.(std::find(message.begin(), message.end(), "Error Number: 102") != message.end()))
                                                                                                                                                                                                                                    ) {
                                                                                                                                                                                                                                        console.error(
                                                                                                                                                                                                                                        "Transaction failed due to instruction deserialization error.",
                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                        console.error(
                                                                                                                                                                                                                                        "This is likely due to parameter mismatch with the on-chain program.",
                                                                                                                                                                                                                                        );

                                                                                                                                                                                                                                        // Trigger the flush animation on error
                                                                                                                                                                                                                                        if (window.flushCoins) {
                                                                                                                                                                                                                                            window.flushCoins();
                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                        throw new Error(
                                                                                                                                                                                                                                        "Failed to create token: instruction format mismatch with on-chain program. Please try again or contact support.",
                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                    // Trigger the flush animation on error
                                                                                                                                                                                                                                    if (window.flushCoins) {
                                                                                                                                                                                                                                        window.flushCoins();
                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                    throw std::runtime_error("Failed to create token on-chain");
                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                // Generate token based on user prompt
                                                                                                                                                                                                                                const auto generateFromPrompt = useCallback(async () => {;
                                                                                                                                                                                                                                    if (!userPrompt.trim()) {
                                                                                                                                                                                                                                        setErrors((prev) => ({
                                                                                                                                                                                                                                            ...prev,
                                                                                                                                                                                                                                            userPrompt: "Please enter a prompt",
                                                                                                                                                                                                                                            }));
                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                        setErrors((prev) => ({
                                                                                                                                                                                                                                            ...prev,
                                                                                                                                                                                                                                            userPrompt: "",
                                                                                                                                                                                                                                            }));

                                                                                                                                                                                                                                            setIsProcessingPrompt(true);

                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                // Prepare headers
                                                                                                                                                                                                                                                const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                    "Content-Type": "application/json",
                                                                                                                                                                                                                                                    };

                                                                                                                                                                                                                                                    if (authToken) {
                                                                                                                                                                                                                                                        "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                    const auto response = fetch(;
                                                                                                                                                                                                                                                    env.apiUrl + "/api/generation/generate-metadata",
                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                        method: "POST",
                                                                                                                                                                                                                                                        headers,
                                                                                                                                                                                                                                                        credentials: "include",
                                                                                                                                                                                                                                                        body: JSON.stringify({
                                                                                                                                                                                                                                                            prompt: userPrompt,
                                                                                                                                                                                                                                                            fields: ["name", "symbol", "description", "prompt"],
                                                                                                                                                                                                                                                            }),
                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                            );

                                                                                                                                                                                                                                                            if (!response.ok) {
                                                                                                                                                                                                                                                                throw std::runtime_error("Failed to generate metadata from prompt");
                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                            const auto data = (response.json());

                                                                                                                                                                                                                                                            if (!data.success || !data.metadata) {
                                                                                                                                                                                                                                                                throw std::runtime_error("Invalid response from the metadata generation API");
                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                            setForm((prev) => ({
                                                                                                                                                                                                                                                                ...prev,
                                                                                                                                                                                                                                                                name: data.metadata.name,
                                                                                                                                                                                                                                                                symbol: data.metadata.symbol,
                                                                                                                                                                                                                                                                description: data.metadata.description,
                                                                                                                                                                                                                                                                prompt: data.metadata.prompt,
                                                                                                                                                                                                                                                                }));

                                                                                                                                                                                                                                                                // Also update autoForm
                                                                                                                                                                                                                                                                setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                    name: data.metadata.name,
                                                                                                                                                                                                                                                                    symbol: data.metadata.symbol,
                                                                                                                                                                                                                                                                    description: data.metadata.description,
                                                                                                                                                                                                                                                                    prompt: data.metadata.prompt,
                                                                                                                                                                                                                                                                    concept: userPrompt,
                                                                                                                                                                                                                                                                    }));

                                                                                                                                                                                                                                                                    // Set the prompt text so it can be reused
                                                                                                                                                                                                                                                                    if (promptFunctions.setPrompt) {
                                                                                                                                                                                                                                                                        promptFunctions.setPrompt(data.metadata.prompt);
                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                            std::cout << "promptFunctions.setPrompt is not available" << std::endl;
                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                        if (promptFunctions.onPromptChange) {
                                                                                                                                                                                                                                                                            promptFunctions.onPromptChange(data.metadata.prompt);
                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                std::cout << "promptFunctions.onPromptChange is not available" << std::endl;
                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                            // Temporarily set the generating state
                                                                                                                                                                                                                                                                            setIsGenerating(true);
                                                                                                                                                                                                                                                                            setGeneratingField("prompt");

                                                                                                                                                                                                                                                                            const auto imageResponse = fetch(;
                                                                                                                                                                                                                                                                            env.apiUrl + "/api/generation/generate",
                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                method: "POST",
                                                                                                                                                                                                                                                                                headers,
                                                                                                                                                                                                                                                                                credentials: "include",
                                                                                                                                                                                                                                                                                body: JSON.stringify({
                                                                                                                                                                                                                                                                                    prompt: data.metadata.prompt,
                                                                                                                                                                                                                                                                                    type: "image",
                                                                                                                                                                                                                                                                                    }),
                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                    );

                                                                                                                                                                                                                                                                                    if (!imageResponse.ok) {
                                                                                                                                                                                                                                                                                        const auto errorText = imageResponse.text();
                                                                                                                                                                                                                                                                                        std::cerr << "Image generation API returned an error:" << errorText << std::endl;
                                                                                                                                                                                                                                                                                        const auto backendError = /* JSON.parse */ errorText.error;

                                                                                                                                                                                                                                                                                        auto userErrorMessage = "Failed to generate image for token.";

                                                                                                                                                                                                                                                                                        if (backendError.includes("NSFW")) {
                                                                                                                                                                                                                                                                                            userErrorMessage =;
                                                                                                                                                                                                                                                                                            "Your input contains inappropriate content. Please modify and try again.";
                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                        throw std::runtime_error(userErrorMessage);
                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                    const auto imageData = (imageResponse.json());

                                                                                                                                                                                                                                                                                    if (!imageData.success || !imageData.mediaUrl) {
                                                                                                                                                                                                                                                                                        std::cerr << "Invalid image data:" << imageData << std::endl;
                                                                                                                                                                                                                                                                                        throw std::runtime_error("Image generation API returned invalid data");
                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                        const auto imageBlob = fetch(imageData.mediaUrl).then((r) => {;
                                                                                                                                                                                                                                                                                            if (!r.ok)
                                                                                                                                                                                                                                                                                            throw new Error(
                                                                                                                                                                                                                                                                                            "Failed to fetch image: " + r.status + " " + r.statusText
                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                            return r.blob();
                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                            const auto imageFile = new File([imageBlob], "generated-image.png", {;
                                                                                                                                                                                                                                                                                                type: "image/png",
                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                // Reset the flag before setting the new image file
                                                                                                                                                                                                                                                                                                hasCreatedUrlFromImage.current = false;
                                                                                                                                                                                                                                                                                                setImageFile(imageFile);
                                                                                                                                                                                                                                                                                                const auto previewUrl = URL.createObjectURL(imageBlob);
                                                                                                                                                                                                                                                                                                setCoinDropImageUrl(previewUrl);

                                                                                                                                                                                                                                                                                                // Update autoForm with the image URL
                                                                                                                                                                                                                                                                                                setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                                                    imageUrl: previewUrl,
                                                                                                                                                                                                                                                                                                    }));

                                                                                                                                                                                                                                                                                                    // Directly update the preview in FormImageInput
                                                                                                                                                                                                                                                                                                    if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                        previewSetterRef.current(previewUrl);
                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                            std::cout << "previewSetterRef.current is not available" << std::endl;
                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                        } catch (imageError) {
                                                                                                                                                                                                                                                                                                            std::cerr << "Error processing generated image:" << imageError << std::endl;
                                                                                                                                                                                                                                                                                                            throw std::runtime_error("Failed to process the generated image");
                                                                                                                                                                                                                                                                                                            } finally {
                                                                                                                                                                                                                                                                                                                setIsGenerating(false);
                                                                                                                                                                                                                                                                                                                setGeneratingField(nullptr);
                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                            // Set hasGeneratedToken to true after successful generation
                                                                                                                                                                                                                                                                                                            setHasGeneratedToken(true);
                                                                                                                                                                                                                                                                                                            } catch (error) {
                                                                                                                                                                                                                                                                                                                std::cerr << "Error generating from prompt:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                // Reset generating state in case of error
                                                                                                                                                                                                                                                                                                                setIsGenerating(false);
                                                                                                                                                                                                                                                                                                                setGeneratingField(nullptr);
                                                                                                                                                                                                                                                                                                                toast.error(;
                                                                                                                                                                                                                                                                                                                true /* instanceof check */;
                                                                                                                                                                                                                                                                                                                ? error.message;
                                                                                                                                                                                                                                                                                                                : "Failed to generate token from prompt. Please try again.",
                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                } finally {
                                                                                                                                                                                                                                                                                                                    setIsProcessingPrompt(false);
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                }, [;
                                                                                                                                                                                                                                                                                                                userPrompt,
                                                                                                                                                                                                                                                                                                                setErrors,
                                                                                                                                                                                                                                                                                                                setIsProcessingPrompt,
                                                                                                                                                                                                                                                                                                                setForm,
                                                                                                                                                                                                                                                                                                                setAutoForm,
                                                                                                                                                                                                                                                                                                                promptFunctions,
                                                                                                                                                                                                                                                                                                                setImageFile,
                                                                                                                                                                                                                                                                                                                setCoinDropImageUrl,
                                                                                                                                                                                                                                                                                                                setIsGenerating,
                                                                                                                                                                                                                                                                                                                setGeneratingField,
                                                                                                                                                                                                                                                                                                                previewSetterRef,
                                                                                                                                                                                                                                                                                                                hasCreatedUrlFromImage,
                                                                                                                                                                                                                                                                                                                createTokenOnChainAsync,
                                                                                                                                                                                                                                                                                                                ]);

                                                                                                                                                                                                                                                                                                                // Import token from address
                                                                                                                                                                                                                                                                                                                const auto importTokenFromAddress = async () => {;
                                                                                                                                                                                                                                                                                                                    // Validate the address
                                                                                                                                                                                                                                                                                                                    if (!isValidTokenAddress(form.importAddress)) {
                                                                                                                                                                                                                                                                                                                        setErrors((prev) => ({
                                                                                                                                                                                                                                                                                                                            ...prev,
                                                                                                                                                                                                                                                                                                                            importAddress: "Please enter a valid token address",
                                                                                                                                                                                                                                                                                                                            }));
                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                        setErrors((prev) => ({
                                                                                                                                                                                                                                                                                                                            ...prev,
                                                                                                                                                                                                                                                                                                                            importAddress: "",
                                                                                                                                                                                                                                                                                                                            }));

                                                                                                                                                                                                                                                                                                                            setIsImporting(true);
                                                                                                                                                                                                                                                                                                                            setImportStatus(nullptr);

                                                                                                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                                                                                                // Ensure wallet is connected
                                                                                                                                                                                                                                                                                                                                if (!publicKey) {
                                                                                                                                                                                                                                                                                                                                    throw std::runtime_error("Wallet not connected");
                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                                                                                                const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                                                                                                // Prepare headers
                                                                                                                                                                                                                                                                                                                                const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                                                                                                    "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                    };

                                                                                                                                                                                                                                                                                                                                    if (authToken) {
                                                                                                                                                                                                                                                                                                                                        "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                        // Fetch token data from a special search endpoint that can find any token
                                                                                                                                                                                                                                                                                                                                        const auto response = "fetch(" + env.apiUrl + "/api/search-token";
                                                                                                                                                                                                                                                                                                                                            method: "POST",
                                                                                                                                                                                                                                                                                                                                            headers,
                                                                                                                                                                                                                                                                                                                                            credentials: "include",
                                                                                                                                                                                                                                                                                                                                            body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                mint: form.importAddress,
                                                                                                                                                                                                                                                                                                                                                requestor: publicKey ? std::to_string(publicKey) : "",
                                                                                                                                                                                                                                                                                                                                                }),
                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                if (!response.ok) {
                                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                                        const auto errorData = (response.json()) as { error?: string };
                                                                                                                                                                                                                                                                                                                                                        if (errorData.error) {
                                                                                                                                                                                                                                                                                                                                                            throw std::runtime_error(errorData.error);
                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                        } catch (parseError) {
                                                                                                                                                                                                                                                                                                                                                            if (response.status == 404) {
                                                                                                                                                                                                                                                                                                                                                                throw new Error(
                                                                                                                                                                                                                                                                                                                                                                "The token doesn"t exist or doesn"t have metadata.",
                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                                    throw new Error(
                                                                                                                                                                                                                                                                                                                                                                    "Server error (" + response.status + "): Unable to retrieve token data. Token either doesn't exist or is already imported."
                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                        const auto tokenData = (response.json()) & {;
                                                                                                                                                                                                                                                                                                                                                            isToken2022?: boolean;
                                                                                                                                                                                                                                                                                                                                                            }; // Add isToken2022 to type assertion;

                                                                                                                                                                                                                                                                                                                                                            // If token has an image URL, fetch and convert to base64
                                                                                                                                                                                                                                                                                                                                                            if (tokenData.image) {
                                                                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                                                                    const auto imageResponse = fetch(tokenData.image);
                                                                                                                                                                                                                                                                                                                                                                    if (imageResponse.ok) {
                                                                                                                                                                                                                                                                                                                                                                        const auto imageBlob = imageResponse.blob();
                                                                                                                                                                                                                                                                                                                                                                        const auto imageFile = new File([imageBlob], "imported-image.png", {;
                                                                                                                                                                                                                                                                                                                                                                            type: "image/png",
                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                            setImageFile(imageFile);

                                                                                                                                                                                                                                                                                                                                                                            // Create preview URL
                                                                                                                                                                                                                                                                                                                                                                            const auto previewUrl = URL.createObjectURL(imageBlob);
                                                                                                                                                                                                                                                                                                                                                                            setCoinDropImageUrl(previewUrl);

                                                                                                                                                                                                                                                                                                                                                                            // Upload the image to our storage
                                                                                                                                                                                                                                                                                                                                                                            const auto uploadResponse = fetch(;
                                                                                                                                                                                                                                                                                                                                                                            env.apiUrl + "/api/upload-import-image"
                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                headers,
                                                                                                                                                                                                                                                                                                                                                                                credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                                                    imageBase64: new Promise((resolve) => {
                                                                                                                                                                                                                                                                                                                                                                                        const auto reader = new FileReader();
                                                                                                                                                                                                                                                                                                                                                                                        reader.onloadend = () => resolve(reader.result);
                                                                                                                                                                                                                                                                                                                                                                                        reader.readAsDataURL(imageBlob);
                                                                                                                                                                                                                                                                                                                                                                                        }),
                                                                                                                                                                                                                                                                                                                                                                                        }),
                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                        );

                                                                                                                                                                                                                                                                                                                                                                                        if (uploadResponse.ok) {
                                                                                                                                                                                                                                                                                                                                                                                            const auto data =;
                                                                                                                                                                                                                                                                                                                                                                                            (uploadResponse.json());
                                                                                                                                                                                                                                                                                                                                                                                            if (data.success && data.imageUrl) {
                                                                                                                                                                                                                                                                                                                                                                                                tokenData.image = data.imageUrl;
                                                                                                                                                                                                                                                                                                                                                                                                // Update the form state with the new image URL
                                                                                                                                                                                                                                                                                                                                                                                                setCoinDropImageUrl(data.imageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                    previewSetterRef.current(data.imageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                    } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                        std::cerr << "Error handling token image:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                // Store token data in localStorage for later use
                                                                                                                                                                                                                                                                                                                                                                                // Include the isToken2022 flag
                                                                                                                                                                                                                                                                                                                                                                                localStorage.setItem("import_token_data", /* JSON.stringify */ std::string(tokenData));
                                                                                                                                                                                                                                                                                                                                                                                setHasStoredToken(true);

                                                                                                                                                                                                                                                                                                                                                                                // Populate the form with token data
                                                                                                                                                                                                                                                                                                                                                                                setForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                                                                                                                                    name: tokenData.name || form.importAddress.slice(0, 8),
                                                                                                                                                                                                                                                                                                                                                                                    symbol: tokenData.symbol || "TOKEN",
                                                                                                                                                                                                                                                                                                                                                                                    description: tokenData.description || "Imported token",
                                                                                                                                                                                                                                                                                                                                                                                    links: {
                                                                                                                                                                                                                                                                                                                                                                                        ...prev.links,
                                                                                                                                                                                                                                                                                                                                                                                        twitter: tokenData.twitter || "",
                                                                                                                                                                                                                                                                                                                                                                                        telegram: tokenData.telegram || "",
                                                                                                                                                                                                                                                                                                                                                                                        website: tokenData.website || "",
                                                                                                                                                                                                                                                                                                                                                                                        discord: tokenData.discord || "",
                                                                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                                                                        }));

                                                                                                                                                                                                                                                                                                                                                                                        // Success message - ready to register
                                                                                                                                                                                                                                                                                                                                                                                        setImportStatus({
                                                                                                                                                                                                                                                                                                                                                                                            type: "success",
                                                                                                                                                                                                                                                                                                                                                                                            message:
                                                                                                                                                                                                                                                                                                                                                                                            "Token data loaded successfully. You can now import this token.",
                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                            } catch (fetchError) {
                                                                                                                                                                                                                                                                                                                                                                                                std::cerr << "API Error:" << fetchError << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                setImportStatus({
                                                                                                                                                                                                                                                                                                                                                                                                    type: "error",
                                                                                                                                                                                                                                                                                                                                                                                                    message:
                                                                                                                                                                                                                                                                                                                                                                                                    true /* instanceof check */;
                                                                                                                                                                                                                                                                                                                                                                                                    ? fetchError.message;
                                                                                                                                                                                                                                                                                                                                                                                                    : "Failed to import token",
                                                                                                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                    std::cerr << "Error importing token:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                    setImportStatus({
                                                                                                                                                                                                                                                                                                                                                                                                        type: "error",
                                                                                                                                                                                                                                                                                                                                                                                                        message:
                                                                                                                                                                                                                                                                                                                                                                                                        true /* instanceof check */ ? error.message : "Failed to import token",
                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                        } finally {
                                                                                                                                                                                                                                                                                                                                                                                                            setIsImporting(false);
                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                        // Function to validate a token address (Solana address is 32-44 characters, base58)
                                                                                                                                                                                                                                                                                                                                                                                                        const auto isValidTokenAddress = (address: string): boolean => {;
                                                                                                                                                                                                                                                                                                                                                                                                            if (!address || address.trim().length < 32 || address.trim().length > 44) {
                                                                                                                                                                                                                                                                                                                                                                                                                return false;
                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                            // Check if it's valid base58 (Solana addresses use base58)
                                                                                                                                                                                                                                                                                                                                                                                                            return BASE58_REGEX.test(address.trim());
                                                                                                                                                                                                                                                                                                                                                                                                            };

                                                                                                                                                                                                                                                                                                                                                                                                            // Handle paste in the import address field
                                                                                                                                                                                                                                                                                                                                                                                                            const auto handleImportAddressPaste = (;
                                                                                                                                                                                                                                                                                                                                                                                                            e: React.ClipboardEvent<HTMLInputElement>,
                                                                                                                                                                                                                                                                                                                                                                                                            ) => {
                                                                                                                                                                                                                                                                                                                                                                                                                const auto pastedText = e.clipboardData.getData("text");

                                                                                                                                                                                                                                                                                                                                                                                                                if (!isValidTokenAddress(pastedText)) {
                                                                                                                                                                                                                                                                                                                                                                                                                    // Prevent default paste if invalid
                                                                                                                                                                                                                                                                                                                                                                                                                    e.preventDefault();

                                                                                                                                                                                                                                                                                                                                                                                                                    setErrors((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                        ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                        importAddress:
                                                                                                                                                                                                                                                                                                                                                                                                                        "Invalid token address format. Please check and try again.",
                                                                                                                                                                                                                                                                                                                                                                                                                        }));

                                                                                                                                                                                                                                                                                                                                                                                                                        return false;
                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                    // Clear any previous errors when pasting valid address
                                                                                                                                                                                                                                                                                                                                                                                                                    setErrors((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                        ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                        importAddress: "",
                                                                                                                                                                                                                                                                                                                                                                                                                        }));

                                                                                                                                                                                                                                                                                                                                                                                                                        return true;
                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                        // Check if form is valid
                                                                                                                                                                                                                                                                                                                                                                                                                        const auto isFormValid =;
                                                                                                                                                                                                                                                                                                                                                                                                                        !!form.name &&;
                                                                                                                                                                                                                                                                                                                                                                                                                        !!form.symbol &&;
                                                                                                                                                                                                                                                                                                                                                                                                                        !!form.description &&;
                                                                                                                                                                                                                                                                                                                                                                                                                        !errors.name &&;
                                                                                                                                                                                                                                                                                                                                                                                                                        !errors.symbol &&;
                                                                                                                                                                                                                                                                                                                                                                                                                        !errors.description &&;
                                                                                                                                                                                                                                                                                                                                                                                                                        !errors.initialSol;

                                                                                                                                                                                                                                                                                                                                                                                                                        // Update coinDropImageUrl directly when we have a preview URL
                                                                                                                                                                                                                                                                                                                                                                                                                        const auto handlePreviewChange = useCallback((previewUrl: string | nullptr) => {;
                                                                                                                                                                                                                                                                                                                                                                                                                            setCoinDropImageUrl(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                            }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                            // Function to generate all fields
                                                                                                                                                                                                                                                                                                                                                                                                                            const auto generateAll = useCallback(;
                                                                                                                                                                                                                                                                                                                                                                                                                            async (;
                                                                                                                                                                                                                                                                                                                                                                                                                            setPrompt?: ((prompt: string) => void) | nullptr,
                                                                                                                                                                                                                                                                                                                                                                                                                            onPromptChange?: ((prompt: string) => void) | nullptr,
                                                                                                                                                                                                                                                                                                                                                                                                                            ) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                                                                                                                                    setIsGenerating(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                    setGeneratingField("name,symbol,description,prompt");

                                                                                                                                                                                                                                                                                                                                                                                                                                    // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                                                                                                                                                                                                    // Prepare headers
                                                                                                                                                                                                                                                                                                                                                                                                                                    const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                        "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                        if (authToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                            "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                        // Get a pre-generated token
                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto response = fetch(;
                                                                                                                                                                                                                                                                                                                                                                                                                                        env.apiUrl + "/api/generation/pre-generated-token",
                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                            method: "GET",
                                                                                                                                                                                                                                                                                                                                                                                                                                            headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                            credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                            );

                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!response.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                throw std::runtime_error("Failed to get pre-generated token");
                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto data = (response.json());
                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto { token } = data;

                                                                                                                                                                                                                                                                                                                                                                                                                                            std::cout << "token" << token << std::endl;

                                                                                                                                                                                                                                                                                                                                                                                                                                            // Store token ID for later use when creating
                                                                                                                                                                                                                                                                                                                                                                                                                                            if (token.id) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                setCurrentPreGeneratedTokenId(token.id);
                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                            // Update forms with generated data
                                                                                                                                                                                                                                                                                                                                                                                                                                            setForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                name: token.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                symbol: token.ticker,
                                                                                                                                                                                                                                                                                                                                                                                                                                                description: token.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                prompt: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                // Update auto form
                                                                                                                                                                                                                                                                                                                                                                                                                                                setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    name: token.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    symbol: token.ticker,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    description: token.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    prompt: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    concept: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                    }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Set user prompt
                                                                                                                                                                                                                                                                                                                                                                                                                                                    setUserPrompt(token.prompt);

                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Set the prompt text so it can be reused
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (setPrompt) setPrompt(token.prompt);
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (onPromptChange) onPromptChange(token.prompt);
                                                                                                                                                                                                                                                                                                                                                                                                                                                    // If we have an image URL, use it directly
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (token.image) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Transform R2 URLs to use local endpoint if needed
                                                                                                                                                                                                                                                                                                                                                                                                                                                        auto imageUrl = token.image;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (imageUrl.includes("r2.dev")) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Extract the filename from the R2 URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto filename = imageUrl.split("/").pop();
                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Use local endpoint instead
                                                                                                                                                                                                                                                                                                                                                                                                                                                            "imageUrl = " + env.apiUrl + "/api/image/" + filename;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto imageBlob = fetch(imageUrl).then((r) => r.blob());
                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto imageFile = new File([imageBlob], "generated-image.png", {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            type: "image/png",
                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                            setImageFile(imageFile);

                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Create a preview URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto previewUrl = URL.createObjectURL(imageBlob);
                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCoinDropImageUrl(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                            setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                imageUrl: previewUrl,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Update preview in FormImageInput
                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    previewSetterRef.current(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // If no image, generate one using the prompt
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto imageResponse = fetch(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    env.apiUrl + "/api/generation/generate",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            prompt: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            type: "image",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );

                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!imageResponse.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                throw std::runtime_error("Failed to generate image");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto imageData =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (imageResponse.json());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto imageUrl = imageData.mediaUrl;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Convert image URL to File object
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto imageBlob = fetch(imageUrl).then((r) => r.blob());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto imageFile = new File([imageBlob], "generated-image.png", {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type: "image/png",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setImageFile(imageFile);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Create a preview URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto previewUrl = URL.createObjectURL(imageBlob);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCoinDropImageUrl(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    imageUrl: previewUrl,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Update preview in FormImageInput
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        previewSetterRef.current(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Set token as generated
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setHasGeneratedToken(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cerr << "Error generating metadata:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    toast.error(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    true /* instanceof check */;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ? error.message;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : "Failed to generate metadata. Please try again.",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } finally {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setIsGenerating(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setGeneratingField(nullptr);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    [setIsGenerating, setGeneratingField],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // --- Vanity Generation Functions --- (Copied and adapted)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto stopVanityGeneration = useCallback(() => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!isGeneratingVanityRef.current) return; // Use ref to check if actually running
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setIsGeneratingVanity(false); // Set state immediately;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        workersRef.current.forEach((worker) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                worker.postMessage("stop"); // Attempt graceful stop;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cout << "Couldn't send stop message to worker" << e << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Terminate after a delay, ensures state update propagates
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setTimeout(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        worker.terminate();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } catch (e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /* ignore */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }, 100);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        workersRef.current = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        startTimeRef.current = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (displayUpdateIntervalRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            clearInterval(displayUpdateIntervalRef.current);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            displayUpdateIntervalRef.current = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }, []); // Removed isGeneratingVanity and vanityResult dependency;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto startVanityGeneration = useCallback(() => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto suffix = vanitySuffix.trim();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setVanityResult(nullptr); // <-- Add this line to clear the previous result;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setDisplayedPublicKey("Generating..."); // Reset display immediately;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto currentError = nullptr;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // 1. Validation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!suffix) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                currentError = "Suffix cannot be empty.";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else if (suffix.size() > 5) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    currentError = "Suffix cannot be longer than 5 characters.";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else if (!BASE58_REGEX.test(suffix)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        currentError =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Invalid suffix. Base58 must be used. This includes: numbers 1-9, letters A-H, J-N, P-Z, a-k, m-z.";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 2. Warnings
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!currentError) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (suffix.length == 5) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            currentError = "Warning: 5-letter suffix may take 24+ hours to find!";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            toast.warn(currentError);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else if (suffix.size() == 4) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                currentError = "Note: 4-letter suffix may take some time to find.";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                toast.info(currentError);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setSuffixError(currentError);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        currentError &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        !currentError.startsWith("Warning") &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        !currentError.startsWith("Note");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return; // Stop if it's a blocking error;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Stop previous generation if any
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        stopVanityGeneration();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setIsGeneratingVanity(true);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto numWorkers =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        navigator.hardwareConcurrency > 12;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ? 8;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        : navigator.hardwareConcurrency || 4;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        startTimeRef.current = Date.now();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        workersRef.current = [];

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Start rolling display effect
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto base58Chars =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto generateRandomString = [&](length: number) {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto result = "";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for (int i = 0; i < length; i++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                result += base58Chars.charAt(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Math.floor(Math.random() * base58Chars.size()),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return result;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            displayUpdateIntervalRef.current = setInterval(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Generate a random prefix matching Solana address length minus suffix length
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto prefixLength = 44 - suffix.size();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto randomPrefix = generateRandomstd::to_string(prefixLength);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "setDisplayedPublicKey(" + randomPrefix + suffix;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }, 100); // Update display frequently;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for (int i = 0; i < numWorkers; i++) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto worker = new InlineVanityWorker();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        worker.onmessage = (event: MessageEvent<WorkerMessage>) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Check generation state *inside* the handler
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!isGeneratingVanityRef.current) return;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto data = event.data;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            switch (data.type) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // case "found":
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (data.validated) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Construct Keypair from secret key array
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto secretKeyUint8Array = new Uint8Array(data.secretKey);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (secretKeyUint8Array.length != 64) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        console.error(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Worker sent invalid secret key length:",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        secretKeyUint8Array.size(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Handle error - maybe try next result? For now, stop.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        stopVanityGeneration();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setSuffixError("Received invalid key from generator.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto foundKeypair = Keypair.fromSecretKey(secretKeyUint8Array);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Double-check the derived public key matches
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (foundKeypair.publicKey.toString() != data.publicKey) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        console.error(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Public key mismatch between worker and derived key!",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setSuffixError("Key validation mismatch.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        stopVanityGeneration(); // Stop on critical error;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setVanityResult({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        publicKey: data.publicKey,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        secretKey: foundKeypair,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setDisplayedPublicKey(data.publicKey); // Show final result;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        stopVanityGeneration(); // Stop all workers;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            console.warn(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "Worker " + data.workerId + " found potential match but validation failed."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Keep searching
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // case "progress":
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Optional: Update stats
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // attemptBatchRef.current += data.count;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // case "error":
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        std::cerr << "Worker " + data.workerId + " error: " + data.error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Optional: Stop all if one worker fails critically?
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // stopVanityGeneration();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        break;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    worker.onerror = (err: any) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        std::cerr << "Worker " + i + " fatal error:" << err << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "setSuffixError(" + "Worker " + i + " failed: " + std::to_string(err.message || "Unknown")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        workersRef.current = workersRef.current.filter((w) => w != worker);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        workersRef.current.size() == 0 &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        isGeneratingVanityRef.current;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setSuffixError("All vanity generators failed!");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            stopVanityGeneration();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            worker.terminate();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /* ignore */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            worker.postMessage({ suffix, workerId: i });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            workersRef.current.push_back(worker);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (workerError) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::cerr << "Failed to create worker " + i + ":" << workerError << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "setSuffixError(" + "Failed to start generator worker " + i + ".";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (workersRef.current.length == 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setSuffixError("Could not start any vanity generator workers.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setIsGeneratingVanity(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setDisplayedPublicKey("--- Error starting generator ---");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (displayUpdateIntervalRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                clearInterval(displayUpdateIntervalRef.current);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                displayUpdateIntervalRef.current = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            startTimeRef.current = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }, [vanitySuffix, stopVanityGeneration]); // Removed isGeneratingVanity use ref;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Use a ref for isGeneratingVanity inside callbacks to avoid stale closures
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto isGeneratingVanityRef = useRef(isGeneratingVanity);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            isGeneratingVanityRef.current = isGeneratingVanity;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }, [isGeneratingVanity]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // submitFormToBackend import
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto submitImportFormToBackend = async () => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setIsSubmitting(true);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!publicKey) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        throw std::runtime_error("Wallet not connected");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Check if we're working with imported token data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto storedTokenData = localStorage.getItem("import_token_data");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (storedTokenData) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto tokenData = /* JSON.parse */ storedTokenData & {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            isToken2022?: boolean;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }; // Add type assertion here too;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Convert image to base64 if exists
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::string media_base64 = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (imageFile) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    media_base64 = new Promise<string>((resolve) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto reader = new FileReader();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        reader.onloadend = () => resolve(reader.result);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        reader.readAsDataURL(imageFile);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Prepare headers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (authToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Create token with the imported data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto createResponse = fetch(env.apiUrl + "/api/create-token", {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tokenMint: tokenData.mint,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                mint: tokenData.mint,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                name: form.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                symbol: form.symbol,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                description: form.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                twitter: form.links.twitter,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                telegram: form.links.telegram,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                website: form.links.website,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                discord: form.links.discord,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                imageBase64: media_base64,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                metadataUrl: tokenData.metadataUri || "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                creator:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tokenData.creators || // Use updateAuthority/creator from search result;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tokenData.updateAuthority ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tokenData.creator || // Fallback to creator if others missing;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "", // Or handle error if no creator found;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                imported: true,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                isToken2022: tokenData.isToken2022 == true, // <<< Pass the flag
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!createResponse.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto errorData = (createResponse.json()) as {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        error?: string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        throw std::runtime_error(errorData.error || "Failed to create token entry");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Clear imported token data from localStorage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    localStorage.removeItem("import_token_data");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setHasStoredToken(false);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Trigger confetti to celebrate successful registration
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (window.createConfettiFireworks) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        window.createConfettiFireworks();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Redirect to token page
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "navigate(" + "/token/" + tokenData.mint;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        true /* instanceof check */ &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        error.(std::find(message.begin(), message.end(), "Token already exists") != message.end());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "navigate(" + "/token/" + tokenData.mint;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (error instanceof Error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            throw error; // Re-throw if it's a permission error
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cerr << "Error submitting import form:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } finally {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setIsSubmitting(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Submit form to backend
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto submitFormToBackend = async () => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // --- Check for Vanity Keypair --- START
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!vanityResult.publicKey || !vanityResult.secretKey) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                toast.error("Please generate a vanity address first.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto mintKeypair = vanityResult.secretKey;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto tokenMint = vanityResult.publicKey;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setIsCreating(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStage("initializing");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStep("Preparing token creation...");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setIsSubmitting(true);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!publicKey) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                throw std::runtime_error("Wallet not connected");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Check if we're working with imported token data - ONLY do this check for IMPORT tab
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto storedTokenData = localStorage.getItem("import_token_data");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (storedTokenData && activeTab == FormTab.IMPORT) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto tokenData = /* JSON.parse */ storedTokenData;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Check if the current wallet has permission to create this token
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // In dev mode, skip this check and allow any wallet to register
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto isCreatorNow =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (tokenData.updateAuthority &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    tokenData.updateAuthority == std::to_string(publicKey)) ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (tokenData.creators &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    tokenData.(std::find(creators.begin(), creators.end(), std::to_string(publicKey) != creators.end())));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cout << "Creator wallet check result:" << isCreatorNow << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cout << "Token update authority:" << tokenData.updateAuthority << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cout << "Token creators:" << tokenData.creators << std::endl;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // if (!isCreatorNow) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //   throw new Error(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //     "You need to connect with the token's creator wallet to register it",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    //   );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Show coin drop animation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setShowCoinDrop(true);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Prepare headers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (authToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Create token record via API
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto createResponse = fetch(env.apiUrl + "/api/create-token", {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                tokenMint: tokenData.mint,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                mint: tokenData.mint,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                name: form.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                symbol: form.symbol,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                description: form.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                twitter: form.links.twitter,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                telegram: form.links.telegram,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                website: form.links.website,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                discord: form.links.discord,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                imageUrl: tokenData.image || "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                metadataUrl: tokenData.metadataUri || "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Include the import flag to indicate this is an imported token
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                imported: false,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!createResponse.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto errorData = (createResponse.json()) as {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        error?: string;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        throw std::runtime_error(errorData.error || "Failed to create token entry");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Clear imported token data from localStorage
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    localStorage.removeItem("import_token_data");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setHasStoredToken(false);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Trigger confetti to celebrate successful registration
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (window.createConfettiFireworks) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        window.createConfettiFireworks();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Redirect to token page
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "navigate(" + "/token/" + tokenData.mint;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        true /* instanceof check */ &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        error.(std::find(message.begin(), message.end(), "Token already exists") != message.end());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "navigate(" + "/token/" + tokenData.mint;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        std::cerr << "Error handling imported token:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (error instanceof Error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            throw error; // Re-throw if it's a permission error
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // For AUTO and MANUAL tabs, we proceed with the regular token creation flow

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // --- Fetch Vanity Keypair from Backend --- REMOVED
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // let tokenMint: string; // Defined above from vanityResult
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // let mintKeypair: Keypair; // Defined above from vanityResult
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // try { ... } catch (error) { ... }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // --- Fetch Vanity Keypair from Backend --- REMOVED

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Convert image to base64 if exists
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::string media_base64 = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (imageFile) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    media_base64 = new Promise<string>((resolve) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto reader = new FileReader();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        reader.onloadend = () => resolve(reader.result);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        reader.readAsDataURL(imageFile);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Create token metadata
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const TokenMetadata tokenMetadata = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        name: form.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        symbol: form.symbol,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        description: form.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        initialSol: parseFloat(form.initialSol) || 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        links: {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ...form.links,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            imageBase64: media_base64 || nullptr,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            tokenMint, // Use client-generated mint address;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            decimals: 9,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            supply: 1000000000000000,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            freezeAuthority: publicKey.toBase58() || "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            mintAuthority: publicKey.toBase58() || "",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // First, uploadImage if needed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto imageUrl = "";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto metadataUrl = "";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Show coin drop with the image we have
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setShowCoinDrop(true);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (media_base64) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto uploadResult = uploadImage({;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ...tokenMetadata,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        tokenMint,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        imageUrl = uploadResult.imageUrl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        metadataUrl = uploadResult.metadataUrl;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Verify metadata URL is valid
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!metadataUrl || metadataUrl == "undefined") {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            console.error(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "Upload succeeded but metadata URL is invalid:",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            metadataUrl,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Fallback: generate a unique metadata URL based on mint address
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            metadataUrl = env.getMetadataUrl(tokenMint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Update the coin drop image to use the final uploaded URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (imageUrl) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCoinDropImageUrl(imageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } catch (uploadError) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            std::cerr << "Error uploading image:" << uploadError << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            throw std::runtime_error("Failed to upload token image");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else if (activeTab == FormTab.IMPORT && coinDropImageUrl) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // For imported tokens, use the image URL directly
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            imageUrl = coinDropImageUrl;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Generate a metadata URL if none exists
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!metadataUrl) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                metadataUrl = env.getMetadataUrl(tokenMint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                console.log(
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Using default metadata URL for imported token:",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                metadataUrl,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else if (!media_base64 && !metadataUrl) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // No image provided, generate minimal metadata URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                metadataUrl = env.getMetadataUrl(tokenMint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Double-check that we have a valid metadata URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!metadataUrl) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::cout << "No metadata URL set << using fallback" << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                metadataUrl = env.getMetadataUrl(tokenMint);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Create token on-chain
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::cout << "Creating token on-chain..." << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Pass the client-generated mintKeypair
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                createTokenOnChain(tokenMetadata, mintKeypair, metadataUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (onChainError) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cerr << "Error creating token on-chain:" << onChainError << std::endl;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Format a user-friendly error message
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    auto errorMessage = "Failed to create token on-chain";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (onChainError instanceof Error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Handle deserialization errors specially
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onChainError.(std::find(message.begin(), message.end(), "instruction format mismatch") != message.end()) ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onChainError.(std::find(message.begin(), message.end(), "InstructionDidNotDeserialize") != message.end()) ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onChainError.(std::find(message.begin(), message.end(), "custom program error: 0x66") != message.end())
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            errorMessage =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "The token creation transaction was rejected by the blockchain. This may be due to a temporary program upgrade. Please try again in a few minutes.";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Try again with different parameters
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Wait a moment before retrying
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                new Promise((resolve) => setTimeout(resolve, 1000));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                toast.info(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "Retrying token creation with different parameters...",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Modify token metadata for retry
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto retryMetadata = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ...tokenMetadata,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    decimals: 9, // Ensure decimals is 9
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    supply: 1000000000000000, // Set explicit supply
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Pass the client-generated mintKeypair again
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    createTokenOnChain(retryMetadata, mintKeypair, metadataUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } catch (retryError) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        std::cerr << "Retry also failed:" << retryError << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Continue to error handling below
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        throw std::runtime_error(errorMessage);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Include original error message for other types of errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "errorMessage = " + "Failed to create token on-chain: " + onChainError.message
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                throw std::runtime_error(errorMessage);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // If we have a pre-generated token ID, mark it as used and remove duplicates
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (currentPreGeneratedTokenId && activeTab == FormTab.AUTO) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Prepare headers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (authToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Mark the token as used and delete any other tokens with the same name or ticker
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        fetch(env.apiUrl + "/api/generation/mark-token-used", {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            method: "POST",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            body: JSON.stringify({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                id: currentPreGeneratedTokenId,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                name: form.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ticker: form.symbol,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                concept: activeTab == FormTab.AUTO ? userPrompt : nullptr,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cerr << "Error marking pre-generated token:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Continue with token creation even if this fails
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            waitForTokenCreation(tokenMint);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Trigger confetti to celebrate successful minting
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (window.createConfettiFireworks) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                window.createConfettiFireworks();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Clear imported token data from localStorage if it exists
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            localStorage.removeItem("import_token_data");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setHasStoredToken(false);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "navigate(" + "/token/" + tokenMint;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // After transaction confirmation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStage("confirming");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStep("Waiting for wallet confirmation...");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // After token creation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStage("creating");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStep("Creating token on-chain...");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // After token record creation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStage("validating");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStep("Validating transaction...");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // After validation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStage("finalizing");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStep("Finalizing token setup...");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::cerr << "Error creating token:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                toast.error(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                true /* instanceof check */;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ? error.message;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                : "Failed to create token. Please try again.",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setIsCreating(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCreationStep("");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCreationStage("initializing");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Ensure coin drop is hidden on error
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setShowCoinDrop(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } finally {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setIsSubmitting(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Handle form submission
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto handleSubmit = async (e: React.FormEvent) => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e.preventDefault();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Validate required fields
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto newErrors = { ...errors };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!form.name) newErrors.name = "Name is required";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!form.symbol) newErrors.symbol = "Symbol is required";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!form.description) newErrors.description = "Description is required";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Validate vanity keypair generation for non-import tabs
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (activeTab != FormTab.IMPORT && (!vanityResult || isGeneratingVanity)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        toast.error("Please generate and wait for a vanity address.");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Validate SOL balance - skip this check for imported tokens
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    isAuthenticated &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    insufficientBalance &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    !(activeTab == FormTab.IMPORT);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        newErrors.initialSol =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "Insufficient SOL balance (need 0.05 SOL for fees)";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        toast.error("You don't have enough SOL to create this token");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Check if there are any errors
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    newErrors.name ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    newErrors.symbol ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    newErrors.description ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    newErrors.initialSol;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setErrors(newErrors);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Submit form to backend
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (activeTab != FormTab.IMPORT) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        submitFormToBackend();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            submitImportFormToBackend();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Fetch pre-generated token on mount for Auto mode
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto loadPreGeneratedToken = async () => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (activeTab == FormTab.AUTO && !hasGeneratedToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setIsGenerating(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setGeneratingField("name,symbol,description,prompt");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Get auth token from localStorage with quote handling
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto authToken = getAuthToken();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Prepare headers
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const std::unordered_map<std::string, std::string> headers = {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "Content-Type": "application/json",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (authToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "headers[\"Authorization\"] = " + "Bearer " + authToken;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Get a pre-generated token
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto response = fetch(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            env.apiUrl + "/api/generation/pre-generated-token",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                method: "GET",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                headers,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                credentials: "include",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                },
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!response.ok) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    throw std::runtime_error("Failed to get pre-generated token");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto data = (response.json());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto { token } = data;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Store token ID for later use when creating
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (token.id) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setCurrentPreGeneratedTokenId(token.id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Set user prompt with the concept
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setUserPrompt(token.prompt);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Update forms with generated data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    name: token.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    symbol: token.ticker,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    description: token.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    prompt: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        name: token.name,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        symbol: token.ticker,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        description: token.description,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        prompt: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        concept: token.prompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Set prompt functions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (promptFunctions.setPrompt)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        promptFunctions.setPrompt(token.prompt);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (promptFunctions.onPromptChange)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        promptFunctions.onPromptChange(token.prompt);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // If token has an image, load it
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (token.image) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Transform R2 URLs to use local endpoint if needed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto imageUrl = token.image;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (std::find(imageUrl.begin(), imageUrl.end(), "r2.dev") != imageUrl.end()) &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            env.(std::find(apiUrl.begin(), apiUrl.end(), "localhost") != apiUrl.end()) &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            env.(std::find(apiUrl.begin(), apiUrl.end(), "127.0.0.1") != apiUrl.end());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Extract the filename from the R2 URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto filename = imageUrl.split("/").pop();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Use local endpoint instead
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "imageUrl = " + env.apiUrl + "/api/image/" + filename;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto imageBlob = fetch(imageUrl).then((r) => r.blob());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto imageFile = new File([imageBlob], "pre-generated-image.png", {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type: "image/png",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Set image file
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setImageFile(imageFile);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Create preview URL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto previewUrl = URL.createObjectURL(imageBlob);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCoinDropImageUrl(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setAutoForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    imageUrl: previewUrl,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }));

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Update preview in FormImageInput
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        previewSetterRef.current(previewUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Set the token as generated since we loaded it from pre-generated
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setHasGeneratedToken(true);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::cerr << "Error loading pre-generated token:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } finally {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setIsGenerating(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setGeneratingField(nullptr);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                loadPreGeneratedToken();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }, [;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                activeTab,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                promptFunctions.setPrompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                promptFunctions.onPromptChange,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                hasGeneratedToken,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // When switching tabs, ensure image state is properly separated
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (activeTab == FormTab.AUTO) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // When switching to Auto, load the auto image
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (autoForm.imageUrl && previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            previewSetterRef.current(autoForm.imageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCoinDropImageUrl(autoForm.imageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } else if (activeTab == FormTab.MANUAL) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Manual mode should always start clean (image was already cleared in handleTabChange)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Only set the image if manualForm has an imageFile from previous Manual session
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (manualForm.imageFile) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto manualImageUrl = URL.createObjectURL(manualForm.imageFile);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setImageFile(manualForm.imageFile);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    previewSetterRef.current(manualImageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCoinDropImageUrl(manualImageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Ensure everything is cleared for Manual mode
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setImageFile(nullptr);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        previewSetterRef.current(nullptr);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setCoinDropImageUrl(nullptr);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else if (activeTab == FormTab.IMPORT && hasStoredToken) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Import tab should only set image from stored token data
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto storedTokenData = localStorage.getItem("import_token_data");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (storedTokenData) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto tokenData = /* JSON.parse */ storedTokenData;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Set the image if available
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (tokenData.image && previewSetterRef.current) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                previewSetterRef.current(tokenData.image);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCoinDropImageUrl(tokenData.image);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (error) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::cerr << "Error parsing stored token data:" << error << std::endl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }, [activeTab, autoForm.imageUrl, manualForm.imageFile, hasStoredToken]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Update manualForm when imageFile changes in Manual mode
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (activeTab == FormTab.MANUAL && imageFile) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setManualForm((prev) => ({
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ...prev,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                imageFile: imageFile,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }, [imageFile, activeTab]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Helper function to calculate token amount based on SOL input using bonding curve formula
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto calculateTokensFromSol = (solAmount: number): number => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Convert SOL to lamports
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto lamports = solAmount * 1e9;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Using constant product formula: (dx * y) / (x + dx)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // where x is virtual reserves, y is token supply, dx is input SOL amount
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto tokenAmount =;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (lamports * TOKEN_SUPPLY) / (VIRTUAL_RESERVES + lamports);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return tokenAmount;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Helper function to calculate percentage of total supply for a given token amount
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto calculatePercentage = (tokenAmount: number): number => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return (tokenAmount / TOKEN_SUPPLY) * 100;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Cleanup object URLs when component unmounts or when URL changes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Store created URLs for cleanup
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const std::vector<std::string> createdUrls = [];

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return [&]() {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Cleanup any object URLs to prevent memory leaks
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            createdUrls.forEach((url) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                URL.revokeObjectURL(url);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Additional cleanup for autoForm.imageUrl when it changes
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto prevImageUrl = autoForm.imageUrl;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return [&]() {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Only cleanup URLs that look like object URLs (blob:)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (prevImageUrl && prevImageUrl.startsWith("blob:")) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            URL.revokeObjectURL(prevImageUrl);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }, [autoForm.imageUrl]);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Cleanup vanity workers on component unmount
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Store the refs in variables before returning the cleanup function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto workersToTerminate = workersRef.current;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto timerToClear = displayUpdateIntervalRef.current;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return [&]() {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                workersToTerminate.forEach((worker) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        worker.postMessage("stop");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        } catch (e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /* ignore */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        try {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            worker.terminate();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } catch (e) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /* ignore */
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (timerToClear) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                clearInterval(timerToClear);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Clear the refs directly - this part is fine
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            workersRef.current = [];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            displayUpdateIntervalRef.current = nullptr;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }, []); // Empty dependency array ensures this runs only on mount and unmount;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto canLaunch = [&]() {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (!publicKey) return false;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (activeTab == FormTab.IMPORT) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // For import, we just need the form data loaded
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return hasStoredToken && !isImporting;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // For Auto/Manual, need valid form, generated vanity key, and enough SOL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto initialSol = parseFloat(form.initialSol) || 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto hasEnoughSol = solBalance >= initialSol + 0.01; // Add buffer for mint cost;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto hasVanityKey = !!vanityResult.publicKey && !isGeneratingVanity;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                hasEnoughSol &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                isFormValid && // Checks name, symbol, desc, initialSol errors;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                hasVanityKey &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                !Object.values(errors).some(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (error) =>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                error &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                !["userPrompt", "importAddress", "percentage"].includes(error), // Ignore non-blocking errors;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Add handler for coin drop cancellation
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto handleCoinDropCancel = useCallback(() => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setShowCoinDrop(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setIsSubmitting(false); // Also reset submitting state;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setIsCreating(false); // Reset creating state;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setCreationStage("initializing"); // Reset creation stage;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setCreationStep("");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Consider stopping vanity generation if cancelled here?
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // stopVanityGeneration();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto [isCreating, setIsCreating] = useState(false);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto [creationStep, setCreationStep] = useState<string>("");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto [creationStage, setCreationStage] = useState<;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "initializing" | "confirming" | "creating" | "validating" | "finalizing";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    >("initializing");

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto [rotation, setRotation] = useState(0);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto interval = setInterval(() => {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setRotation((prev) => prev + 90);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }, 1000);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return [&]() { return clearInterval(interval); };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Add effect to listen for log messages and update state
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            useEffect(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const auto originalConsoleLog = console.log;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                console.log = (...args) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    originalConsoleLog(...args);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Check for specific log messages to update state
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto message = args[0];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (typeof message == "string") {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (message.includes("Token created on-chain successfully")) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStage("validating");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setCreationStep("Token created successfully, validating...");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            } else if (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            (std::find(message.begin(), message.end(), "Waiting for token creation confirmation") != message.end());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCreationStage("validating");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setCreationStep("Waiting for blockchain confirmation...");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else if ((std::find(message.begin(), message.end(), "waiting for creation from token mint") != message.end())) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setCreationStage("validating");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setCreationStep("Confirming token creation on-chain...");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    } else if ((std::find(message.begin(), message.end(), "Creating token on-chain...") != message.end())) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setCreationStage("creating");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setCreationStep("Creating token on-chain...");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return [&]() {;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    console.log = originalConsoleLog;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }, []);

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    return (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="flex flex-col items-center justify-center">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* {showCoinDrop ? (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <CoinDrop;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                imageUrl={coinDropImageUrl || std::nullopt}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            onCancel={handleCoinDropCancel}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) : nullptr} */}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <form;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        className="py-4 px-auto w-full max-w-2xl flex font-dm-mono flex-col m-auto gap-1 justify-center";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onSubmit={handleSubmit}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Tabs Navigation */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="flex items-center md:justify-between flex-col md:flex-row gap-8 mx-auto w-full mb-2">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="flex shrink-0 items-center gap-4">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                src="/create/dicelogo.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt="Coin Machine";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="w-24 h-24";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                src="/create/coinmachine.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt="Coin Machine";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="w-48 h-24";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="flex justify-between items-center text-lg w-full shrink">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {Object.values(FormTab).map((tab, _) => (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <button;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                key={tab} // Added key;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type="button";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "className={" + "uppercase font-satoshi font-medium transition-colors duration-200 cursor-pointer select-none " + std::to_string();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    activeTab == tab;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ? "border-[#03FF24] text-[#03FF24] font-bold";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : "border-transparent text-neutral-400 hover:text-white"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "}";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            onClick={() => handleTabChange(tab)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {tab}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </button>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Auto Tab Content */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {activeTab == FormTab.AUTO && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="flex">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <input;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type="text";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            value={userPrompt}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onChange={(e) => setUserPrompt(e.target.value)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onKeyDown={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (e.key == "Enter") {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        placeholder="Enter a concept like "a halloween token about arnold schwarzenegger"";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        className="flex-1 truncate my-2 p-0 border-b-2 pb-2.5 border-b-[#03FF24] text-white bg-transparent focus:outline-none focus:border-b-white"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <button;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        type="button";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onClick={generateFromPrompt}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                disabled={isProcessingPrompt || !userPrompt.trim()}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="p-0 transition-colors disabled:opacity-50"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                src={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    isProcessingPrompt;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ? "/create/generating.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : "/create/generateup.svg"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt="Generate";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="w-24 ml-2";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onMouseDown={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isProcessingPrompt) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generatedown.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onMouseUp={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isProcessingPrompt) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generateup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onDragStart={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isProcessingPrompt) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generateup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onMouseOut={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isProcessingPrompt) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generateup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </button>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {errors.userPrompt && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="text-red-500 text-sm">{errors.userPrompt}</div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* Import Tab Content */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {activeTab == FormTab.IMPORT && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="flex flex-col gap-4">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="flex flex-col gap-2">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="flex flex-row">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <input;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    type="text";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                value={form.importAddress || ""}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onChange={(e) =>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                handleChange("importAddress", e.target.value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            alt="Generate" // This alt doesn't make sense here;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onPaste={handleImportAddressPaste}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        placeholder="Enter any Solana token address (mint)";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        className="flex-1 truncate my-2 p-0 border-b-2 pb-2.5 border-b-[#03FF24] text-white bg-transparent focus:outline-none focus:border-b-white"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <button;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        type="button";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onClick={importTokenFromAddress}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    disabled={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        isImporting ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        !form.importAddress.trim() ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        !isValidTokenAddress(form.importAddress);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    className="p-0 transition-colors disabled:opacity-50"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    src={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        isImporting;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ? "/create/importing.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        : "/create/importup.svg"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alt="Import";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    className="w-32 mb-2";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onMouseDown={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!isImporting) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            img.src = "/create/importdown.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onMouseUp={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!isImporting) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            img.src = "/create/importup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onDragStart={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!isImporting) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            img.src = "/create/importup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onMouseOut={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (!isImporting) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            img.src = "/create/importup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </button>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {errors.importAddress && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="text-red-500 text-sm">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {errors.importAddress}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Enhanced import status with clearer guidance */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {importStatus && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "className={" + "p-3 border  mb-4 " + std::to_string();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            importStatus.type == "error";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ? "border-red-500 bg-red-950/20 text-red-400";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            : importStatus.type == "warning"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ? "border-yellow-500 bg-yellow-950/20 text-yellow-400";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            : "border-green-500 bg-green-950/20 text-[#03FF24]"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "}";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="flex items-center gap-2 text-sm">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {importStatus.type == "success" ? (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Icons.Check className="w-5 h-5 flex-shrink-0" />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) : importStatus.type == "warning" ? (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Icons.Warning className="w-5 h-5 flex-shrink-0" />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) : (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Icons.XCircle className="w-5 h-5 flex-shrink-0" />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span className="font-medium">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {importStatus.message}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Additional guidance for different status types */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {importStatus.type == "warning" && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="mt-2 ml-7 text-sm text-yellow-300/80">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The token details have been loaded below. Please;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            connect with the token's creator wallet to register;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            it.;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {publicKey && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Current wallet:{" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span className="font-mono">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {std::to_string(publicKey).slice(0, 4) +;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "..." +;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    std::to_string(publicKey).slice(-4)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Form Section (Image, Desc, Vanity, Buy, Launch) */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {(activeTab == FormTab.MANUAL ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (activeTab == FormTab.AUTO && hasGeneratedToken) ||;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (activeTab == FormTab.IMPORT && hasStoredToken)) && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="grid gap-4">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Image & Core Fields */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="flex flex-col gap-3">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Image with overlay inputs */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <FormImageInput;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onChange={(file) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (activeTab == FormTab.MANUAL) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setImageFile(file);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setManualForm((prev) => ({ ...prev, imageFile: file }));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onPromptChange={handlePromptChange}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                isGenerating={isGenerating && generatingField == "prompt"}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setIsGenerating={setIsGenerating}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        setGeneratingField={setGeneratingField}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onPromptFunctionsChange={(setPrompt, onPromptChange) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            setPromptFunctions({ setPrompt, onPromptChange });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onPreviewChange={handlePreviewChange}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    imageUrl={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        activeTab == FormTab.AUTO;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ? autoForm.imageUrl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        : activeTab == FormTab.IMPORT && hasStoredToken
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ? coinDropImageUrl;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        : std::nullopt
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    onDirectPreviewSet={(setter) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        previewSetterRef.current = setter;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                activeTab={activeTab}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            nameValue={form.name}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onNameChange={(value) => handleChange("name", value)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    tickerValue={form.symbol}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onTickerChange={(value) => handleChange("symbol", value)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                "key={" + "image-input-" + activeTab;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Description Field */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {activeTab == FormTab.IMPORT ? (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "className={" + "bg-transparent text-white text-xl font-bold focus:outline-none px-1 py-0.5 mb-4"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {form.description}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ) : (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <FormTextArea;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                value={form.description}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) =>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                handleChange("description", e.target.value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            label="Description";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        minRows={1}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        placeholder="Description";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    maxLength={2000}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                error={errors.description}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onClick={() =>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                generateAll(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                promptFunctions.setPrompt,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                promptFunctions.onPromptChange,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } // Pass prompt fns;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            isLoading={isGenerating && generatingField == "description"}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* Vanity Address Section (Only for Auto/Manual) */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {activeTab != FormTab.IMPORT && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="flex flex-col gap-2">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <label className="text-whitem py-1.5 uppercase text-sm font-medium tracking-wider">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Generate Contract Address;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </label>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Display Area */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="font-mono text-xs md:text-lg lg:text-xl break-all min-h-[2.5em] flex items-center justify-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span className="mr-2">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {isGeneratingVanity ? (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span className="animate-pulse">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {displayedPublicKey.slice(0, -vanitySuffix.size())}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <strong>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {displayedPublicKey.slice(-vanitySuffix.size())}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </strong>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) : vanityResult ? (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span className="text-green-400">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {displayedPublicKey.slice(0, -vanitySuffix.size())}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <strong>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {displayedPublicKey.slice(-vanitySuffix.size())}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </strong>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ) : (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <span className="text-neutral-500">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {displayedPublicKey.slice(0, -vanitySuffix.size())}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <strong>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {displayedPublicKey.slice(-vanitySuffix.size())}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </strong>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div className="flex items-center gap-2 mx-auto">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <input;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    type="text";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                value={vanitySuffix}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onChange={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    stopVanityGeneration(); // Stop generation when suffix changes;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    setVanitySuffix(e.target.value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }} // Force uppercase;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    placeholder="FUN";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                maxLength={5}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "className={" + "bg-autofun-background-input w-20 py-1.5 px-2 " + std::to_string(suffixError && !suffixError.startsWith("Warning") && !suffixError.startsWith("Note") ? "border-red-500" : "") + " text-white text-center font-mono focus:outline-none focus:border-white disabled:opacity-50"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <button;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            type="button";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            onClick={() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                stopVanityGeneration(); // Stop existing workers first;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Use a small timeout to allow state updates from stop to settle
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setTimeout(() => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    startVanityGeneration(); // Then start with the new suffix;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }, 50);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                src={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    isGeneratingVanity;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ? "/create/generating.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : "/create/generateup.svg"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt="Generate";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="w-24 ml-2";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onMouseDown={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isGeneratingVanity) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generatedown.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onMouseUp={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isGeneratingVanity) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generateup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onDragStart={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isGeneratingVanity) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generateup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                onMouseOut={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    e.preventDefault();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const auto img = e.target;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (!isGeneratingVanity) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        img.src = "/create/generateup.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </button>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p className="mx-auto text-center text-xs text-neutral-500 mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Choose a custom suffix;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <br />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Longer suffixes are slower to generate;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Error/Warning Display */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {suffixError && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "className={" + "text-xs " + std::to_string(suffixError.startsWith("Warning") || suffixError.startsWith("Note") ? "text-yellow-400" : "text-red-500") + " mt-1"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {suffixError}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Buy Section (Hide for Import) */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {activeTab != FormTab.IMPORT && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="flex flex-col gap-3 justify-end uppercase">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="flex flex-row gap-3 justify-end uppercase">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span className="text-white text-xl font-medium relative group">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Buy;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span className="inline-block ml-1 cursor-help">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <Icons.Info className="h-4 w-4 text-[#8c8c8c] hover:text-white" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="absolute hidden group-hover:block right-0 bottom-8 p-3 text-xs normal-case bg-black border border-neutral-800 shadow-lg z-10 w-64">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Added width */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p className="text-white mb-2">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Choose how much of the token you want to buy on;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                launch:
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p className="text-neutral-400 mb-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <b>SOL</b>: Amount of SOL to invest
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p className="text-neutral-400 mb-2">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <b>%</b>: Percentage of token supply to acquire
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="border-t border-neutral-800 pt-2 mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p className="text-neutral-400 text-xs">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Total token supply: {TOKEN_SUPPLY.toLocaleString()}{" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            tokens;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="text-neutral-400 text-xs mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Pricing follows a bonding curve, your percentage;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            increases with more SOL.;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="border-t border-neutral-800 pt-2 mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="text-neutral-400 text-xs">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Maximum supply of 50% can be purchased prior to coin;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            launch;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="flex flex-col items-end">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="relative">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <input;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            type="number";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        value={buyValue}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        onChange={(e) => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto value = e.target.value.replace(" SOL", "");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            value = value.replace(/[^\d.]/g, "");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto decimalCount = (value.match(/\./g) || []);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            .size();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (decimalCount > 1) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                value = value.substring(0, value.lastIndexOf(".")); // Keep only first decimal;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto parts = value.split(".");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto wholePart = parts[0] || "0"; // Default to 0 if empty;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            auto decimalPart = parts[1] || "";

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Limit whole part length (e.g., 2 digits for SOL up to 99)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            wholePart.size() >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            std::to_string(Math.floor(MAX_INITIAL_SOL)).size();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                wholePart = wholePart.slice(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                std::to_string(Math.floor(MAX_INITIAL_SOL)).size(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Limit decimal part length
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (decimalPart.length > 2) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Allow 2 decimal places
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                decimalPart = decimalPart.slice(0, 2);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            value = decimalPart;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            "? " + wholePart + "." + decimalPart;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            : wholePart;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Final numeric check against maxInputSol
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const auto numValue = parseFloat(value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (!isNaN(numValue)) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (numValue < 0) value = "0";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                else if (numValue > maxInputSol);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                value = std::to_string(maxInputSol);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } else if (value != "") {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    value = "0"; // Reset invalid non-empty strings;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                handleChange("initialSol", value || "0"); // Ensure it's not empty string for state;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                setBuyValue(value); // Update local buyValue state;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            min="0";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        max={std::to_string(maxInputSol)}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        step="0.01";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        className="w-26 pr-10 text-white text-xl font-medium text-right inline border-b border-b-[#424242] focus:outline-none focus:border-white bg-transparent" // Added bg-transparent
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        />;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <span className="absolute right-0 top-0 bottom-0 flex items-center text-white text-xl font-medium pointer-events-none">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Adjusted positioning */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                SOL;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </span>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* {solPrice && Number(buyValue) > 0 && ( ... )} */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {parseFloat(buyValue) > 0 && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="text-right text-xs text-neutral-400">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {calculatePercentage(;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        calculateTokensFromSol(parseFloat(buyValue)),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ).toFixed(2)}{" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    % of supply;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Balance information */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="mt-2 text-right text-xs text-neutral-400">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Balance: {solBalance.toFixed(2) || "0.00"} SOL
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {isAuthenticated && isFormValid && insufficientBalance && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="text-red-500 mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Insufficient SOL balance (need ~0.05 SOL for mint + buy;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            amount);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {Number(buyValue) == maxInputSol &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        maxInputSol < MAX_INITIAL_SOL && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div className="text-yellow-500 mt-1">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Maximum amount based on your balance;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                )}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Launch Button */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div className="flex flex-col items-center gap-3 mt-4">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {" "}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* Added margin-top */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <button;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    type="submit";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    className="p-0 transition-colors cursor-pointer disabled:opacity-50 select-none"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                disabled={!canLaunch() || isSubmitting}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                src={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    isSubmitting || isCreating // Show launching if submitting or creating;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ? "/create/launching.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : activeTab == FormTab.IMPORT
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ? "/create/importup-thick.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : "/create/launchup.svg"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt="Launch";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                className="h-32 mb-4 select-none pointer-events-none" // Removed mouse handlers, handle state via disabled/src;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </button>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Validation/Auth Messages */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {!isAuthenticated ? (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="text-red-500 text-center text-sm">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Please connect your wallet to create a token.;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ) : !canLaunch() &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            !isSubmitting &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            activeTab != FormTab.IMPORT ? ( // Show only if not launchable and not submitting;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="text-red-500 text-center text-sm">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Please fill required fields, ensure sufficient SOL, and;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            generate a vanity address.;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            ) : !canLaunch() &&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            !isSubmitting &&;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            activeTab == FormTab.IMPORT ? (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="text-red-500 text-center text-sm">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Please load token data via the import field above.;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ) : nullptr}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </form>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Creation Loading Modal */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {isCreating && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="fixed inset-0 flex items-center justify-center z-[60]">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="bg-[#1A1A1A]/80 p-6 shadow-lg max-w-md w-full">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div className="flex items-center flex-col gap-3">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    width: "128px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    height: "128px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    perspective: "1000px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    position: "relative",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    transformStyle: "preserve-3d",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    transition: "transform 0.5s ease",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    "transform: " + "rotateY(" + rotation + "deg)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {/* Front face - left half */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                position: "absolute",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                backfaceVisibility: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                display: "flex",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                justifyContent: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                alignItems: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                overflow: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                transform: "rotateY(0deg) translateZ(64px)",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            src="/logo_wide.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            alt="logo front";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                width: "256px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                objectFit: "cover",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                objectPosition: "-3% 0",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {/* Right face - right half */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            position: "absolute",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            backfaceVisibility: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            display: "flex",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            justifyContent: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            alignItems: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            overflow: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            transform: "rotateY(90deg) translateZ(64px)",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            overflow: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            position: "relative",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        src="/logo_wide.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        alt="logo right";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            position: "absolute",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            width: "256px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            right: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            objectFit: "cover",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            objectPosition: "100% 0",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {/* Back face - left half */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        position: "absolute",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        backfaceVisibility: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        display: "flex",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        justifyContent: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        alignItems: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        overflow: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        transform: "rotateY(180deg) translateZ(64px)",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    src="/logo_wide.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alt="logo back";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        width: "256px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        objectFit: "cover",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        objectPosition: "-3% 0",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                {/* Left face - right half */}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    position: "absolute",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    backfaceVisibility: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    display: "flex",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    justifyContent: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    alignItems: "center",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    overflow: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    transform: "rotateY(270deg) translateZ(64px)",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <div;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    width: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    overflow: "hidden",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    position: "relative",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                >;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <img;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                src="/logo_wide.svg";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                alt="logo left";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                style={{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    position: "absolute",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    height: "100%",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    width: "256px",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    right: 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    objectFit: "cover",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    objectPosition: "100% 0",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                />;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                <p className="font-dm-mono text-base text-autofun-text-secondary">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            {creationStep}
                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            {creationStage == "confirming" && (;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p className="font-dm-mono text-sm text-autofun-text-secondary/80">;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            Please confirm the transaction in your wallet;
                                                                                                                                                                                                                                                                                                                                                                                                                                                            </p>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                        </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    );

    } catch (const std::exception& e) {
        std::cerr << "Error: " << e.what() << std::endl;
        throw;
    }
}

} // namespace elizaos
